<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin API - Sauron Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-xl font-bold text-purple-600">← Back to Sauron</a>
                <div class="text-sm text-gray-600">Admin API</div>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto px-4 py-12">
        <h1 class="text-4xl font-bold text-gray-800 mb-8">Admin API Reference</h1>
        
        <!-- Authentication -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Authentication</h2>
            
            <div class="bg-white p-6 rounded-lg shadow-sm border">
                <p class="text-gray-600 mb-4">
                    All admin endpoints require authentication using the admin key configured in your environment variables.
                </p>
                
                <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre># Using header authentication
curl -X GET https://your-domain.com/admin/cleanup/status \
  -H "X-Admin-Key: your_admin_key_here"

# Using JSON body authentication
curl -X POST https://your-domain.com/admin/cleanup \
  -H "Content-Type: application/json" \
  -d '{
    "admin_key": "your_admin_key_here",
    "operations": ["logs"]
  }'</pre>
                </div>
            </div>
        </section>

        <!-- Cleanup API -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Cleanup Operations</h2>
            
            <div class="space-y-6">
                <!-- POST /admin/cleanup -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">POST /admin/cleanup</h3>
                    <p class="text-gray-600 mb-4">Execute cleanup operations with fine-grained control</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-semibold mb-2">Available Operations:</h4>
                            <ul class="text-sm space-y-1">
                                <li><code>logs</code> - Remove old log files</li>
                                <li><code>database</code> - Clean old user_links records</li>
                                <li><code>credentials</code> - Clear secure memory storage</li>
                                <li><code>firestore</code> - Remove old cloud documents</li>
                                <li><code>all</code> - Execute all cleanup operations</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Request Parameters:</h4>
                            <ul class="text-sm space-y-1">
                                <li><code>admin_key</code> - Authentication key</li>
                                <li><code>operations</code> - Array of operations</li>
                                <li><code>retention_days</code> - Keep data newer than N days</li>
                                <li><code>dry_run</code> - Preview mode (optional)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>POST /admin/cleanup
Content-Type: application/json

{
  "admin_key": "your_admin_key_here",
  "operations": ["logs", "database"],
  "retention_days": 30,
  "dry_run": false
}

Response:
{
  "success": true,
  "operations": {
    "logs": {
      "success": true,
      "items_removed": 15,
      "size_freed": 2048576,
      "details": "Processed 20 log files"
    },
    "database": {
      "success": true,
      "items_removed": 150,
      "size_freed": 15000,
      "details": "Found 150 old records for cleanup"
    }
  },
  "total_size_freed": 2063576,
  "message": "Cleanup completed. Freed 2.0 MB across 2 operations",
  "timestamp": "2024-01-15T10:30:00Z"
}</pre>
                    </div>
                </div>

                <!-- GET /admin/cleanup/status -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">GET /admin/cleanup/status</h3>
                    <p class="text-gray-600 mb-4">Get current system status and cleanup statistics</p>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>GET /admin/cleanup/status
X-Admin-Key: your_admin_key_here

Response:
{
  "database": {
    "user_links": 1250,
    "config": 1,
    "banned_ips": 45
  },
  "logs": {
    "total_files": 12,
    "total_size": "15.2 MB"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customer Risk Management -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Customer Risk Management</h2>
            
            <div class="space-y-6">
                <!-- POST /admin/risk -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">POST /admin/risk</h3>
                    <p class="text-gray-600 mb-4">Customer risk analysis and threat detection endpoint</p>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>POST /admin/risk
Content-Type: application/json

{
  "admin_key": "your_admin_key_here",
  "action": "analyze",
  "customer_id": "optional_customer_id"
}

Response:
{
  "success": true,
  "risk_analysis": {
    "threat_level": "medium",
    "suspicious_patterns": ["high_frequency_requests", "unusual_geo_locations"],
    "recommendations": ["enable_rate_limiting", "geo_blocking"]
  },
  "timestamp": "2024-01-15T10:30:00Z"
}</pre>
                    </div>
                </div>

                <!-- GET /admin/metrics -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">GET /admin/metrics</h3>
                    <p class="text-gray-600 mb-4">Get comprehensive customer metrics and analytics</p>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>GET /admin/metrics
X-Admin-Key: your_admin_key_here

Response:
{
  "success": true,
  "metrics": {
    "total_customers": 150,
    "active_sessions": 23,
    "total_requests_24h": 15000,
    "avg_response_time": "120ms",
    "error_rate": "0.5%"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Decoy System Management -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Intelligent Decoy System</h2>
            
            <div class="space-y-6">
                <!-- POST /admin/decoy -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">POST /admin/decoy</h3>
                    <p class="text-gray-600 mb-4">Control the intelligent decoy traffic generation system</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-semibold mb-2">Available Actions:</h4>
                            <ul class="text-sm space-y-1">
                                <li><code>start</code> - Start decoy traffic generation</li>
                                <li><code>stop</code> - Stop decoy traffic generation</li>
                                <li><code>configure</code> - Update decoy settings</li>
                                <li><code>reset</code> - Reset decoy system</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Configuration Options:</h4>
                            <ul class="text-sm space-y-1">
                                <li><code>intensity</code> - Traffic intensity level (1-10)</li>
                                <li><code>pattern</code> - Traffic pattern type</li>
                                <li><code>targets</code> - Target endpoints</li>
                                <li><code>schedule</code> - Timing configuration</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>POST /admin/decoy
Content-Type: application/json

{
  "admin_key": "your_admin_key_here",
  "action": "configure",
  "config": {
    "intensity": 5,
    "pattern": "random",
    "enabled": true
  }
}

Response:
{
  "success": true,
  "decoy_status": "configured",
  "current_config": {
    "intensity": 5,
    "pattern": "random",
    "enabled": true,
    "last_updated": "2024-01-15T10:30:00Z"
  }
}</pre>
                    </div>
                </div>

                <!-- GET /admin/decoy/status -->
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4 text-purple-600">GET /admin/decoy/status</h3>
                    <p class="text-gray-600 mb-4">Get current decoy system status and statistics</p>
                    
                    <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>GET /admin/decoy/status
X-Admin-Key: your_admin_key_here

Response:
{
  "success": true,
  "decoy_system": {
    "status": "active",
    "intensity": 5,
    "pattern": "random",
    "requests_generated_24h": 12500,
    "effectiveness_score": 85,
    "last_activity": "2024-01-15T10:29:45Z"
  },
  "statistics": {
    "total_decoy_requests": 125000,
    "detection_evasion_rate": "94%",
    "system_load_impact": "minimal"
  }
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics and Monitoring -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Statistics and Monitoring</h2>
            
            <div class="bg-white p-6 rounded-lg shadow-sm border">
                <h3 class="text-lg font-semibold mb-4">GET /stats</h3>
                <p class="text-gray-600 mb-4">Get statistics for a specific slug (requires slug parameter)</p>
                
                <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre>GET /stats?slug=your-slug-here

Response:
{
  "visits": 150,
  "logs": 89,
  "valid": 23,
  "invalid": 12
}</pre>
                </div>
                
                <div class="mt-4 grid md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-3 rounded-lg text-center">
                        <div class="text-lg font-bold text-blue-600">Visits</div>
                        <div class="text-sm text-blue-700">Total unique visitors</div>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded-lg text-center">
                        <div class="text-lg font-bold text-green-600">Logs</div>
                        <div class="text-sm text-green-700">Events logged</div>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded-lg text-center">
                        <div class="text-lg font-bold text-green-600">Valid</div>
                        <div class="text-sm text-green-700">Successful captures</div>
                    </div>
                    
                    <div class="bg-red-50 p-3 rounded-lg text-center">
                        <div class="text-lg font-bold text-red-600">Invalid</div>
                        <div class="text-sm text-red-700">Failed attempts</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Error Handling -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Error Handling</h2>
            
            <div class="bg-white p-6 rounded-lg shadow-sm border">
                <h3 class="text-lg font-semibold mb-4">Standard Error Responses</h3>
                
                <div class="space-y-4">
                    <div class="border-l-4 border-red-400 pl-4">
                        <h4 class="font-semibold text-red-600">400 Bad Request</h4>
                        <p class="text-sm text-gray-600">Invalid admin key or malformed request</p>
                        <div class="bg-red-50 p-2 rounded mt-2 text-xs font-mono">
                            {"success": false, "error": "Invalid admin key"}
                        </div>
                    </div>
                    
                    <div class="border-l-4 border-red-400 pl-4">
                        <h4 class="font-semibold text-red-600">401 Unauthorized</h4>
                        <p class="text-sm text-gray-600">Missing or invalid authentication</p>
                        <div class="bg-red-50 p-2 rounded mt-2 text-xs font-mono">
                            {"success": false, "error": "Authentication required"}
                        </div>
                    </div>
                    
                    <div class="border-l-4 border-red-400 pl-4">
                        <h4 class="font-semibold text-red-600">404 Not Found</h4>
                        <p class="text-sm text-gray-600">Requested slug or resource does not exist</p>
                        <div class="bg-red-50 p-2 rounded mt-2 text-xs font-mono">
                            {"success": false, "error": "Slug not found"}
                        </div>
                    </div>
                    
                    <div class="border-l-4 border-red-400 pl-4">
                        <h4 class="font-semibold text-red-600">500 Internal Server Error</h4>
                        <p class="text-sm text-gray-600">Server error - check system logs</p>
                        <div class="bg-red-50 p-2 rounded mt-2 text-xs font-mono">
                            {"success": false, "error": "Internal server error"}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Security Considerations -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Security Considerations</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-green-50 border border-green-200 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-800 mb-4">✅ Security Features</h3>
                    <ul class="space-y-2 text-sm text-green-700">
                        <li>• Admin key authentication for all endpoints</li>
                        <li>• Secure memory storage for sensitive data</li>
                        <li>• Encrypted communication over HTTPS</li>
                        <li>• Anti-forensics cleanup operations</li>
                        <li>• Intelligent decoy traffic generation</li>
                        <li>• Rate limiting and abuse protection</li>
                        <li>• Detailed audit logging</li>
                    </ul>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-4">⚠️ Best Practices</h3>
                    <ul class="space-y-2 text-sm text-yellow-700">
                        <li>• Use strong, unique admin keys</li>
                        <li>• Regularly rotate authentication credentials</li>
                        <li>• Monitor admin endpoint access logs</li>
                        <li>• Use dry run mode before destructive operations</li>
                        <li>• Implement network-level access controls</li>
                        <li>• Regular security audits and updates</li>
                        <li>• Backup critical configuration data</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- CLI Tools -->
        <section class="mb-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">CLI Tools and Scripts</h2>
            
            <div class="bg-white p-6 rounded-lg shadow-sm border">
                <h3 class="text-lg font-semibold mb-4">Admin Cleanup Script</h3>
                <p class="text-gray-600 mb-4">
                    Convenient shell script for common admin operations:
                </p>
                
                <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
<pre># Preview log cleanup (30 days retention)
./scripts/admin_cleanup.sh logs 30 --dry-run

# Clean database records older than 7 days
./scripts/admin_cleanup.sh database 7

# Emergency cleanup - delete all cleanable data
./scripts/admin_cleanup.sh all 0

# Get current system status
./scripts/admin_cleanup.sh status

# Configure decoy system
./scripts/admin_cleanup.sh decoy start --intensity 7</pre>
                </div>
                
                <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400">
                    <p class="text-blue-700 text-sm">
                        <strong>Note:</strong> The CLI scripts automatically handle authentication using environment variables.
                    </p>
                </div>
            </div>
        </section>
    </div>
</body>
</html>
