<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¥ Kill Switch Dashboard - Sauron Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b1b 100%);
            color: #ff6b6b;
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
            margin-bottom: 10px;
        }

        .warning {
            background: rgba(255, 255, 0, 0.1);
            border: 2px solid #ffff00;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            color: #ffff00;
            font-weight: bold;
            text-align: center;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .panel h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }

        .panel h2 .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #444;
            border-radius: 5px;
            color: #fff;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            color: white;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #cc0000, #990000);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9500, #e6851a);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e6851a, #cc7700);
            transform: translateY(-2px);
        }

        .btn-info {
            background: linear-gradient(135deg, #00aaff, #0088cc);
            color: white;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #0088cc, #006699);
            transform: translateY(-2px);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .status-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
        }

        .status-card h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background: #00ff00; }
        .status-warning { background: #ffaa00; }
        .status-critical { background: #ff0000; }
        .status-offline { background: #666; }

        .log-area {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .log-output {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            color: #00ff00;
        }

        .destruction-levels {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .level-card {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-card:hover {
            background: rgba(255, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .level-card.selected {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff6b6b;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .level-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff0000;
        }

        .level-name {
            font-size: 0.8em;
            color: #ccc;
            margin-top: 5px;
        }

        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #ff0000;
            font-size: 1.8em;
        }

        .countdown {
            font-size: 2em;
            color: #ff0000;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #cc0000);
            width: 0%;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .destruction-levels {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¥ KILL SWITCH DASHBOARD</h1>
            <p>Sauron Pro Emergency Destruction System</p>
        </div>

        <div class="warning">
            ‚ö†Ô∏è WARNING: This system will PERMANENTLY DESTROY target systems. Use only in emergency situations. ‚ö†Ô∏è
        </div>

        <div class="dashboard-grid">
            <!-- Kill Switch Control Panel -->
            <div class="panel">
                <h2><span class="icon">üíÄ</span>Kill Switch Control</h2>
                
                <div class="form-group">
                    <label for="adminKey">Admin Key:</label>
                    <input type="password" id="adminKey" placeholder="Enter admin authentication key">
                </div>

                <div class="form-group">
                    <label for="targetVPS">Target VPS:</label>
                    <select id="targetVPS">
                        <option value="">Select VPS...</option>
                        <option value="ALL">üî¥ ALL VPS (FLEET-WIDE DESTRUCTION)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Destruction Level:</label>
                    <div class="destruction-levels">
                        <div class="level-card" data-level="1">
                            <div class="level-number">1</div>
                            <div class="level-name">Memory</div>
                        </div>
                        <div class="level-card" data-level="2">
                            <div class="level-number">2</div>
                            <div class="level-name">Data</div>
                        </div>
                        <div class="level-card" data-level="3">
                            <div class="level-number">3</div>
                            <div class="level-name">System</div>
                        </div>
                        <div class="level-card" data-level="4">
                            <div class="level-number">4</div>
                            <div class="level-name">Hardware</div>
                        </div>
                        <div class="level-card" data-level="5">
                            <div class="level-number">5</div>
                            <div class="level-name">Stealth</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="delaySeconds">Delay (seconds):</label>
                    <input type="number" id="delaySeconds" value="30" min="0" max="300">
                </div>

                <div class="form-group">
                    <label for="reason">Reason:</label>
                    <textarea id="reason" rows="3" placeholder="Emergency justification..."></textarea>
                </div>

                <button class="btn btn-danger" onclick="initiateKillSwitch()">
                    üî¥ INITIATE KILL SWITCH
                </button>
            </div>

            <!-- Dead Man's Switch Control -->
            <div class="panel">
                <h2><span class="icon">üíÄ</span>Dead Man's Switch</h2>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="deadManEnabled"> Enable Dead Man's Switch
                    </label>
                </div>

                <div class="form-group">
                    <label for="checkInterval">Check Interval (minutes):</label>
                    <input type="number" id="checkInterval" value="5" min="1" max="60">
                </div>

                <div class="form-group">
                    <label for="masterTimeout">Master Timeout (minutes):</label>
                    <input type="number" id="masterTimeout" value="15" min="5" max="120">
                </div>

                <div class="form-group">
                    <label for="autoDestruct">Auto-Destruct Level:</label>
                    <select id="autoDestruct">
                        <option value="0">Disabled</option>
                        <option value="1">Level 1 - Memory</option>
                        <option value="2">Level 2 - Data</option>
                        <option value="3" selected>Level 3 - System</option>
                        <option value="4">Level 4 - Hardware</option>
                        <option value="5">Level 5 - Stealth</option>
                    </select>
                </div>

                <button class="btn btn-warning" onclick="updateDeadMansSwitch()">
                    Update Configuration
                </button>
                
                <button class="btn btn-info" onclick="sendHeartbeat()">
                    Send Heartbeat
                </button>
            </div>
        </div>

        <!-- Status Dashboard -->
        <div class="panel">
            <h2><span class="icon">üìä</span>System Status</h2>
            <div class="status-grid">
                <div class="status-card">
                    <h3>VPS Fleet Status</h3>
                    <div id="fleetStatus">Loading...</div>
                </div>
                <div class="status-card">
                    <h3>Dead Man's Switch</h3>
                    <div id="deadManStatus">Loading...</div>
                </div>
                <div class="status-card">
                    <h3>Last Heartbeat</h3>
                    <div id="heartbeatStatus">Loading...</div>
                </div>
                <div class="status-card">
                    <h3>System Health</h3>
                    <div id="systemHealth">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Log Output -->
        <div class="panel log-area">
            <h2><span class="icon">üìù</span>Operation Logs</h2>
            <div class="log-output" id="logOutput">
[INFO] Kill Switch Dashboard initialized
[INFO] Awaiting commands...
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üî¥ CONFIRM DESTRUCTION</h2>
                <p>This action is IRREVERSIBLE</p>
            </div>
            
            <div id="confirmationDetails"></div>
            
            <div class="countdown" id="countdown"></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-danger" onclick="confirmDestruction()">
                    CONFIRM DESTRUCTION
                </button>
                <button class="btn btn-info" onclick="cancelDestruction()" style="margin-left: 10px;">
                    CANCEL
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedLevel = 3;
        let masterEndpoint = 'https://master.sauron.pro';
        let confirmationTimer;
        let progressTimer;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadVPSList();
            loadDeadMansSwitchConfig();
            updateStatus();
            
            // Update status every 30 seconds
            setInterval(updateStatus, 30000);
            
            // Setup destruction level selection
            document.querySelectorAll('.level-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedLevel = parseInt(this.dataset.level);
                    logMessage(`Selected destruction level ${selectedLevel}`);
                });
            });
            
            // Select level 3 by default
            document.querySelector('[data-level="3"]').classList.add('selected');
        });

        function logMessage(message, type = 'INFO') {
            const timestamp = new Date().toLocaleTimeString();
            const logOutput = document.getElementById('logOutput');
            const logEntry = `[${timestamp}] [${type}] ${message}\n`;
            logOutput.textContent += logEntry;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        async function loadVPSList() {
            try {
                const adminKey = document.getElementById('adminKey').value;
                if (!adminKey) return;

                const response = await fetch(`${masterEndpoint}/fleet/instances`, {
                    headers: {
                        'Authorization': `Bearer ${adminKey}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const select = document.getElementById('targetVPS');
                    
                    // Clear existing options except "Select VPS..." and "ALL"
                    select.innerHTML = `
                        <option value="">Select VPS...</option>
                        <option value="ALL">üî¥ ALL VPS (FLEET-WIDE DESTRUCTION)</option>
                    `;
                    
                    if (data.instances) {
                        data.instances.forEach(vps => {
                            const option = document.createElement('option');
                            option.value = vps.id;
                            option.textContent = `${vps.id} - ${vps.domain} (${vps.status})`;
                            select.appendChild(option);
                        });
                    }
                    
                    logMessage(`Loaded ${data.instances?.length || 0} VPS instances`);
                }
            } catch (error) {
                logMessage(`Error loading VPS list: ${error.message}`, 'ERROR');
            }
        }

        async function loadDeadMansSwitchConfig() {
            try {
                const adminKey = document.getElementById('adminKey').value;
                if (!adminKey) return;

                const response = await fetch(`/admin/deadmans`, {
                    headers: {
                        'Authorization': `Bearer ${adminKey}`
                    }
                });

                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('deadManEnabled').checked = config.enabled;
                    document.getElementById('checkInterval').value = config.check_interval / 60; // Convert to minutes
                    document.getElementById('masterTimeout').value = config.master_timeout / 60; // Convert to minutes
                    document.getElementById('autoDestruct').value = config.destruction_level;
                    
                    logMessage('Dead man\'s switch configuration loaded');
                }
            } catch (error) {
                logMessage(`Error loading dead man's switch config: ${error.message}`, 'ERROR');
            }
        }

        async function updateStatus() {
            try {
                // Update fleet status
                const fleetStatus = document.getElementById('fleetStatus');
                fleetStatus.innerHTML = '<span class="status-indicator status-active"></span>Fleet Online';

                // Update dead man's switch status
                const deadManStatus = document.getElementById('deadManStatus');
                const enabled = document.getElementById('deadManEnabled').checked;
                deadManStatus.innerHTML = `<span class="status-indicator ${enabled ? 'status-active' : 'status-offline'}"></span>${enabled ? 'Armed' : 'Disabled'}`;

                // Update heartbeat status
                const heartbeatStatus = document.getElementById('heartbeatStatus');
                heartbeatStatus.innerHTML = '<span class="status-indicator status-active"></span>Recent';

                // Update system health
                const systemHealth = document.getElementById('systemHealth');
                systemHealth.innerHTML = '<span class="status-indicator status-active"></span>Operational';

            } catch (error) {
                logMessage(`Error updating status: ${error.message}`, 'ERROR');
            }
        }

        function initiateKillSwitch() {
            const adminKey = document.getElementById('adminKey').value;
            const targetVPS = document.getElementById('targetVPS').value;
            const delaySeconds = document.getElementById('delaySeconds').value;
            const reason = document.getElementById('reason').value;

            if (!adminKey) {
                alert('Admin key is required');
                return;
            }

            if (!targetVPS) {
                alert('Please select a target VPS');
                return;
            }

            if (!reason.trim()) {
                alert('Reason is required for audit trail');
                return;
            }

            // Show confirmation modal
            const modal = document.getElementById('confirmationModal');
            const details = document.getElementById('confirmationDetails');
            
            details.innerHTML = `
                <p><strong>Target:</strong> ${targetVPS === 'ALL' ? 'ENTIRE FLEET' : targetVPS}</p>
                <p><strong>Destruction Level:</strong> ${selectedLevel}</p>
                <p><strong>Delay:</strong> ${delaySeconds} seconds</p>
                <p><strong>Reason:</strong> ${reason}</p>
                <p style="color: #ff0000; font-weight: bold; margin-top: 20px;">
                    This will PERMANENTLY DESTROY the target system(s)
                </p>
            `;
            
            modal.style.display = 'block';
            
            // Start 10-second countdown
            let countdown = 10;
            const countdownElement = document.getElementById('countdown');
            const progressFill = document.getElementById('progressFill');
            
            confirmationTimer = setInterval(() => {
                countdownElement.textContent = countdown;
                progressFill.style.width = ((10 - countdown) / 10 * 100) + '%';
                
                if (countdown <= 0) {
                    clearInterval(confirmationTimer);
                    cancelDestruction();
                }
                countdown--;
            }, 1000);
        }

        async function confirmDestruction() {
            clearInterval(confirmationTimer);
            document.getElementById('confirmationModal').style.display = 'none';

            const adminKey = document.getElementById('adminKey').value;
            const targetVPS = document.getElementById('targetVPS').value;
            const delaySeconds = parseInt(document.getElementById('delaySeconds').value);
            const reason = document.getElementById('reason').value;

            const payload = {
                admin_key: adminKey,
                vps_id: targetVPS === 'ALL' ? '' : targetVPS,
                destruction_level: selectedLevel,
                delay_seconds: delaySeconds,
                reason: reason,
                confirmation_code: 'OMEGA-DESTROY'
            };

            try {
                logMessage('üî¥ INITIATING KILL SWITCH', 'CRITICAL');
                logMessage(`Target: ${targetVPS}, Level: ${selectedLevel}, Delay: ${delaySeconds}s`, 'CRITICAL');

                const response = await fetch(`${masterEndpoint}/admin/killswitch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    logMessage('üî¥ KILL SWITCH ACTIVATED SUCCESSFULLY', 'CRITICAL');
                    logMessage(`Message: ${result.message}`, 'INFO');
                    
                    if (delaySeconds > 0) {
                        logMessage(`‚è±Ô∏è Destruction will begin in ${delaySeconds} seconds`, 'WARNING');
                        
                        // Show countdown
                        let remaining = delaySeconds;
                        const countdownInterval = setInterval(() => {
                            logMessage(`üíÄ Destruction in: ${remaining} seconds`, 'CRITICAL');
                            remaining--;
                            
                            if (remaining < 0) {
                                clearInterval(countdownInterval);
                                logMessage('üíÄ DESTRUCTION INITIATED', 'CRITICAL');
                            }
                        }, 1000);
                    }
                } else {
                    logMessage(`‚ùå Kill switch activation failed: ${result.error || 'Unknown error'}`, 'ERROR');
                }
            } catch (error) {
                logMessage(`‚ùå Error activating kill switch: ${error.message}`, 'ERROR');
            }
        }

        function cancelDestruction() {
            clearInterval(confirmationTimer);
            document.getElementById('confirmationModal').style.display = 'none';
            logMessage('Kill switch activation cancelled', 'INFO');
        }

        async function updateDeadMansSwitch() {
            const adminKey = document.getElementById('adminKey').value;
            const enabled = document.getElementById('deadManEnabled').checked;
            const checkInterval = parseInt(document.getElementById('checkInterval').value) * 60; // Convert to seconds
            const masterTimeout = parseInt(document.getElementById('masterTimeout').value) * 60; // Convert to seconds
            const destructionLevel = parseInt(document.getElementById('autoDestruct').value);

            if (!adminKey) {
                alert('Admin key is required');
                return;
            }

            const config = {
                enabled: enabled,
                check_interval: checkInterval,
                master_timeout: masterTimeout,
                auto_destruct: destructionLevel > 0,
                destruction_level: destructionLevel
            };

            try {
                const response = await fetch('/admin/deadmans', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminKey}`
                    },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    logMessage('üíÄ Dead man\'s switch configuration updated', 'INFO');
                    updateStatus();
                } else {
                    logMessage('‚ùå Failed to update dead man\'s switch configuration', 'ERROR');
                }
            } catch (error) {
                logMessage(`‚ùå Error updating dead man's switch: ${error.message}`, 'ERROR');
            }
        }

        async function sendHeartbeat() {
            const adminKey = document.getElementById('adminKey').value;

            if (!adminKey) {
                alert('Admin key is required');
                return;
            }

            try {
                const response = await fetch('/vps/heartbeat', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminKey}`
                    }
                });

                if (response.ok) {
                    logMessage('üíì Heartbeat sent successfully', 'INFO');
                } else {
                    logMessage('‚ùå Failed to send heartbeat', 'ERROR');
                }
            } catch (error) {
                logMessage(`‚ùå Error sending heartbeat: ${error.message}`, 'ERROR');
            }
        }

        // Auto-refresh VPS list when admin key is entered
        document.getElementById('adminKey').addEventListener('input', function() {
            if (this.value.length > 10) {
                loadVPSList();
                loadDeadMansSwitchConfig();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'K') {
                document.getElementById('adminKey').focus();
            }
        });
    </script>
</body>
</html>
